 ---
 name: Build Docs
 
 on:
   push:
     # Sequence of patterns matched against refs/tags
     tags:
       - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10
   workflow_dispatch:
     inputs:
       version:
         description: Manual Doc Build Reason
         default: test
         required: false
 
 jobs:
   docs:
     name: Build and Push Docs (${{ matrix.os }}-${{ matrix.environment-file }})
     runs-on: ${{ matrix.os }}
     continue-on-error: ${{ matrix.experimental }}
     timeout-minutes: 90
     strategy:
       matrix:
         os: ['ubuntu-latest']
         environment-file: [ci/313-latest.yaml]
         experimental: [false]
     defaults:
       run:
         shell: bash -l {0}

     steps:
       - name: Checkout repo
         uses: actions/checkout@v4

       - name: Setup micromamba
         uses: mamba-org/setup-micromamba@v2
         with:
           environment-file: ${{ matrix.environment-file }}
           micromamba-version: 'latest'

       - name: Install esda
         run: pip install .

       - name: Make Docs
         run: cd docs; make html

       - name: push to gh-pages
         uses: ad-m/github-push-action@master
         with:
           branch: gh-pages
           directory: gh-pages
           github_token: ${{ secrets.GITHUB_TOKEN }}
           force: true
